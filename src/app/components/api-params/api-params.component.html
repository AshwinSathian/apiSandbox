<p-card class="w-full">
  <div class="space-y-6">
    <div class="flex flex-col gap-4 md:flex-row">
      <div class="w-full md:w-1/4">
        <p-floatlabel variant="in">
          <p-select
            class="w-full"
            [options]="requestMethods"
            appendTo="body"
            [(ngModel)]="selectedRequestMethod"
            (ngModelChange)="onRequestMethodChange($event)"
          ></p-select>
          <label class="uppercase"> Request Method </label>
        </p-floatlabel>
      </div>
      <div class="w-full md:w-3/4">
        <p-floatlabel variant="in">
          <input pInputText type="url" class="w-full" [(ngModel)]="endpoint" />
          <label class="uppercase"> API Endpoint </label>
        </p-floatlabel>
        @if (endpointError !== '') {
        <small class="mt-1 block text-sm text-red-400">
          {{ endpointError }}
        </small>
        }
      </div>
    </div>

    <section class="rounded-lg bg-slate-900/40 p-6">
      <div class="hidden md:block">
        <p-tabs [(value)]="activeTab">
          <p-tablist>
            <p-tab value="headers">
              <span class="uppercase">Headers</span>
            </p-tab>
            @if (isBodyMethod(selectedRequestMethod)) {
            <p-tab value="body">
              <span class="uppercase">Body</span>
            </p-tab>
            }
          </p-tablist>
          <p-tabpanels>
            <p-tabpanel value="headers">
              <ng-container [ngTemplateOutlet]="headersTemplate"></ng-container>
            </p-tabpanel>
            @if (isBodyMethod(selectedRequestMethod)) {
            <p-tabpanel value="body">
              <ng-container [ngTemplateOutlet]="bodyTemplate"></ng-container>
            </p-tabpanel>
            }
          </p-tabpanels>
        </p-tabs>
      </div>
      <div class="md:hidden">
        <p-accordion
          [multiple]="true"
          [value]="mobileActivePanels"
          (valueChange)="onMobileIndexChange($event)"
        >
          <p-accordionpanel value="headers">
            <ng-template pTemplate="header">
              <span class="uppercase">Headers</span>
            </ng-template>
            <ng-container [ngTemplateOutlet]="headersTemplate"></ng-container>
          </p-accordionpanel>
          @if (isBodyMethod(selectedRequestMethod)) {
          <p-accordionpanel value="body">
            <ng-template pTemplate="header">
              <span class="uppercase">Body</span>
            </ng-template>
            <ng-container [ngTemplateOutlet]="bodyTemplate"></ng-container>
          </p-accordionpanel>
          }
        </p-accordion>
      </div>
    </section>

    <ng-template #headersTemplate>
      <div class="flex flex-col gap-2">
        <div
          class="hidden grid-cols-12 gap-4 px-2 text-sm font-semibold uppercase tracking-wide md:grid"
        >
          <div class="md:col-span-5">Key</div>
          <div class="md:col-span-6">Value</div>
          <div class="md:col-span-1 text-center"></div>
        </div>
        @for (item of requestHeaders; track item; let index = $index) {
        <div
          class="flex flex-col gap-3 md:grid md:grid-cols-12 md:items-center md:gap-4"
        >
          <div class="w-full md:col-span-5">
            <input
              pInputText
              [disabled]="item.key === 'Content-Type'"
              class="requestBodyItem w-full"
              [(ngModel)]="item.key"
            />
          </div>
          <div class="w-full md:col-span-6">
            <input
              pInputText
              [disabled]="item.key === 'Content-Type'"
              class="requestBodyItem w-full"
              [(ngModel)]="item.value"
            />
          </div>
          <div class="flex justify-end md:block md:col-span-1 md:text-center">
            <button
              pButton
              type="button"
              text
              icon="pi pi-times"
              [disabled]="item.key === 'Content-Type'"
              severity="danger"
              (click)="removeItem(index, 'Headers')"
            ></button>
          </div>
        </div>
        }
        <div class="pt-2">
          <button
            pButton
            type="button"
            icon="pi pi-plus"
            label="Add Header"
            class="uppercase"
            [disabled]="isAddDisabled('Headers')"
            severity="secondary"
            (click)="addItem('Headers')"
          ></button>
        </div>
      </div>
    </ng-template>

    <ng-template #bodyTemplate>
      <div class="flex flex-col gap-2">
        <div
          class="hidden grid-cols-12 gap-4 px-2 text-sm font-semibold uppercase tracking-wide md:grid"
        >
          <div class="md:col-span-4">Key</div>
          <div class="md:col-span-4">Value</div>
          <div class="md:col-span-3">Data Type</div>
          <div class="md:col-span-1 text-center"></div>
        </div>
        @for (item of requestBody; track item; let index = $index) {
        <div class="flex flex-col gap-3 md:grid md:grid-cols-12 md:items-center md:gap-4">
          <div class="w-full md:col-span-4">
            <input
              pInputText
              class="requestBodyItem w-full"
              [(ngModel)]="item.key"
            />
          </div>
          <div class="w-full md:col-span-4">
            @if (requestBodyDataTypes[index] !== 'Boolean') {
            <input
              pInputText
              [type]="
                requestBodyDataTypes[index]
                  ? requestBodyDataTypes[index].toLowerCase()
                  : 'text'
              "
              [disabled]="requestBodyDataTypes[index] === ''"
              class="requestBodyItem w-full"
              [(ngModel)]="item.value"
            />
            } @if (requestBodyDataTypes[index] === 'Boolean') {
            <p-select
              class="w-full"
              [disabled]="requestBodyDataTypes[index] === ''"
              [options]="booleanOptions"
              optionLabel="label"
              optionValue="value"
              appendTo="body"
              placeholder="Select"
              [(ngModel)]="item.value"
            ></p-select>
            }
          </div>
          <div class="w-full md:col-span-3">
            <p-select
              class="w-full"
              [options]="availableDataTypes"
              optionLabel="label"
              optionValue="value"
              appendTo="body"
              placeholder="Data Type"
              [(ngModel)]="requestBodyDataTypes[index]"
            ></p-select>
          </div>
          <div class="hidden md:flex justify-end md:col-span-1">
            <button
              pButton
              text
              type="button"
              icon="pi pi-times"
              severity="danger"
              (click)="removeItem(index, 'Body')"
            ></button>
          </div>
          <div class="md:hidden col-span-1">
            <button
              pButton
              text
              type="button"
              icon="pi pi-times"
              label="Remove"
              severity="danger"
              (click)="removeItem(index, 'Body')"
            ></button>
          </div>
        </div>
        }
        <div class="my-4">
          <button
            pButton
            type="button"
            icon="pi pi-plus"
            label="Add Item"
            class="uppercase"
            [disabled]="isAddDisabled('Body')"
            severity="secondary"
            (click)="addItem('Body')"
          ></button>
        </div>
      </div>
    </ng-template>

    <button
      pButton
      type="button"
      [disabled]="!endpoint"
      label="Send Request"
      class="uppercase"
      (click)="sendRequest()"
    ></button>

    @if (loadingState || responseData||responseError) {
    <div class="mt-6 w-full min-h-[10vh] rounded-lg bg-black/80 p-4">
      @if (loadingState) {
      <div class="space-y-3">
        <p-skeleton height="2rem" borderRadius="0.75rem"></p-skeleton>
        <p-skeleton height="1.5rem" borderRadius="0.75rem"></p-skeleton>
        <p-skeleton height="8rem" borderRadius="1rem"></p-skeleton>
      </div>
      } @if (responseData) {
      <pre class="whitespace-pre-wrap text-green-400">{{ responseData }}</pre>
      } @if (responseError) {
      <pre class="whitespace-pre-wrap text-red-400">{{ responseError }}</pre>
      }
    </div>
    }
  </div>
</p-card>
